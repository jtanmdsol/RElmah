<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="Scripts/jquery-1.6.4.js"></script>
    <script src="Scripts/jquery.signalR-2.1.2.js"></script>

    <script src="Scripts/rx.js"></script>
    <script src="Scripts/rx.async.js"></script>
    <script src="Scripts/rx.binding.js"></script>

    <script src="Scripts/relmah/relmah.js"></script>

    <script>
        $(function () {

            var r = relmah("http://localhost:9474/signalr", {
                    errors: function (errs) {
                        return errs;
                    }
                }),
                errors = r.getErrors(),
                apps   = r.getApplications();

            errors.subscribe(function (e) {
                var cont = $('<li/>');

                $('<span/>')
                    .text(e.Error.Message)
                    .appendTo(cont);

                cont.prependTo($('#errors-' + e.SourceId));
            });

            apps.filter(function (a) { return !a.removed; }).subscribe(function (app) {
                var name = app.name;
                if (!$('#app-' + name).length) {
                    var cont = $('<li/>')
                        .attr('id', 'app-' + name);

                    $('<p/>')
                        .text(name)
                        .appendTo(cont);

                    $('<ul/>')
                        .attr('id', 'errors-' + name)
                        .appendTo(cont);

                    cont.appendTo($('#apps'));
                }

                $('#app-' + name).css({ 'background-color': 'yellow' });
            });

            apps.filter(function (a) { return a.removed; }).subscribe(function (app) {
                var name = app.name;
                if ($('#app-' + name).length) {
                    $('#app-' + name).css({ 'background-color': 'grey' });
                }
            });

            $('#login').click(function () {
                $('#user').attr("disabled", "disabled");
                $('#login').hide();

                r.start({ 'user': $('#user').val() });
            });
        });
    </script>
</head>
    <body>
        <input type="text" id="user"/><button id="login">Login</button>
        <ul id="apps"></ul>
    </body>
</html>
